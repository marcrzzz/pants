<!DOCTYPE html>
<html lang="en">

<!--
  Copyright 2014 Pants project contributors (see CONTRIBUTORS.md).
  Licensed under the Apache License, Version 2.0 (see LICENSE).
-->

<head>
  <meta charset="utf-8"/>
  <title>Develop a Task to Publish &quot;Extra&quot; Artifacts</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="shortcut icon" href="pants-logo.ico">
  <!-- In case this is a "test publish", tell search engines where real version lives: -->
  <link rel="canonical" href="http://pantsbuild.org/dev_tasks_publish_extras.html">

  <link rel="stylesheet" href="bootstrap-custom.min.css">
  <link rel="stylesheet" href="bootstrap-custom-theme.min.css">
  <link rel="stylesheet" href="docsite.css">
</head>

<body>

<div class="header">
  <nav class="navbar navbar-default navbar-static-top">
    <div class="container">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand navbar-brand-img" href="index.html">
          <img src="pants-logo.ico" alt="[pantsbuild logo]">
        </a>
        <a class="navbar-brand" href="index.html">
          Pants
        </a>
      </div>
      <div id="navbar" class="navbar-collapse collapse">
        <ul class="nav navbar-nav navbar-right">
          <li><a href="index.html/">Docs</a></li>
          <li><a href="community.html">Community</a></li>
          <li><a href="https://www.github.com/pantsbuild/pants">GitHub</a></li>
          <li>
            <form class="navbar-form navbar-left search" role="search" action="https://www.google.com/search">
              <div class="form-group">
                <input type="text" name="as_q" class="form-control query" placeholder="Search">
                <input name="as_sitesearch" value="pantsbuild.org" type="hidden">
              </div>
            </form>
          </li>
        </ul>
      </div><!--/.nav-collapse -->
    </div>
  </nav>
</div>

<div class="page">

  <div class="container-fluid">
    <div class="row">

      <div class="col-md-1">
      </div>

      <div class="col-md-2">
        <div class="site-toc">
          <ul>
                  <li class="toc-h1 toc-heading">
                    Getting Started
                  </li>
                  <li class="toc-h1 toc-link ">
                    <a href="install.html">Installing Pants</a>
                  </li>
                  <li class="toc-h1 toc-link ">
                    <a href="setup_repo.html">Setting Up Pants</a>
                  </li>
                  <li class="toc-h1 toc-link ">
                    <a href="first_tutorial.html">Tutorial</a>
                  </li>
                  <li class="toc-h1 toc-link ">
                    <a href="common_tasks.html">Common Tasks</a>
                  </li>
                  <li class="toc-h1 toc-heading">
                    Pants Basics
                  </li>
                  <li class="toc-h1 toc-link ">
                    <a href="why_use_pants.html">Why Use Pants?</a>
                  </li>
                  <li class="toc-h1 toc-link ">
                    <a href="first_concepts.html">Pants Concepts</a>
                  </li>
                  <li class="toc-h1 toc-link ">
                    <a href="build_files.html">BUILD files</a>
                  </li>
                  <li class="toc-h1 toc-link ">
                    <a href="target_addresses.html">Target Addresses</a>
                  </li>
                  <li class="toc-h1 toc-link ">
                    <a href="3rdparty.html">Third-Party Dependencies</a>
                  </li>
                  <li class="toc-h1 toc-link ">
                    <a href="options.html">Pants Options</a>
                  </li>
                  <li class="toc-h1 toc-link ">
                    <a href="invoking.html">Invoking Pants</a>
                  </li>
                  <li class="toc-h1 toc-link ">
                    <a href="reporting_server.html">Reporting Server</a>
                  </li>
                  <li class="toc-h1 toc-link ">
                    <a href="ide_support.html">IDE Support</a>
                  </li>
                <li class="toc-h1">
                  <a class="sidebar-nav-heading" class= "toc-drop" data-toggle="collapse" href="#JVM-Support" aria-expanded="false" aria-controls="JVM-Support">JVM Support<span class="caret"></span></a>
                  <ul class="collapse sidebar-nav sidebar-submenu" id="JVM-Support">
                      <li class="toc-h1 toc-link ">
                        <a href="jvm_projects.html">JVM Projects with Pants</a>
                      </li>
                      <li class="toc-h1 toc-link ">
                        <a href="3rdparty_jvm.html">JVM Dependency Management</a>
                      </li>
                      <li class="toc-h1 toc-link ">
                        <a href="scala.html">Scala Support</a>
                      </li>
                      <li class="toc-h1 toc-link ">
                        <a href="publish.html">Publishing Artifacts</a>
                      </li>
                      <li class="toc-h1 toc-link ">
                        <a href="from_maven.html">Pants for Maven Experts</a>
                      </li>
                  </ul>
                </li>
                <li class="toc-h1">
                  <a class="sidebar-nav-heading" class= "toc-drop" data-toggle="collapse" href="#Python-Support" aria-expanded="false" aria-controls="Python-Support">Python Support<span class="caret"></span></a>
                  <ul class="collapse sidebar-nav sidebar-submenu" id="Python-Support">
                      <li class="toc-h1 toc-link ">
                        <a href="python_readme.html">Python Projects with Pants</a>
                      </li>
                      <li class="toc-h1 toc-link ">
                        <a href="3rdparty_py.html">Python 3rdparty Pattern</a>
                      </li>
                  </ul>
                </li>
                  <li class="toc-h1 toc-link ">
                    <a href="go_readme.html">Go support for Pants</a>
                  </li>
                  <li class="toc-h1 toc-heading">
                    Code &amp; Doc Gen
                  </li>
                  <li class="toc-h1 toc-link ">
                    <a href="thrift_deps.html">Thrift</a>
                  </li>
                  <li class="toc-h1 toc-link ">
                    <a href="page.html">Markdown</a>
                  </li>
                  <li class="toc-h1 toc-heading">
                    Getting Help
                  </li>
                  <li class="toc-h1 toc-link ">
                    <a href="tshoot.html">Troubleshooting</a>
                  </li>
                  <li class="toc-h1 toc-link ">
                    <a href="community.html">Community</a>
                  </li>
                  <li class="toc-h1 toc-heading">
                    Reference
                  </li>
                  <li class="toc-h1 toc-link ">
                    <a href="build_dictionary.html">Pants BUILD Dictionary</a>
                  </li>
                  <li class="toc-h1 toc-link ">
                    <a href="options_reference.html">Pants Reference</a>
                  </li>
                <li class="toc-h1">
                  <a class="sidebar-nav-heading" class= "toc-drop" data-toggle="collapse" href="#Release-Notes" aria-expanded="false" aria-controls="Release-Notes">Release Notes<span class="caret"></span></a>
                  <ul class="collapse sidebar-nav sidebar-submenu" id="Release-Notes">
                      <li class="toc-h1 toc-link ">
                        <a href="notes-1.6.x.html">1.6.x Stable Releases</a>
                      </li>
                      <li class="toc-h1 toc-link ">
                        <a href="notes-1.5.x.html">1.5.x Stable Releases</a>
                      </li>
                      <li class="toc-h1 toc-link ">
                        <a href="notes-1.4.x.html">1.4.x Stable Releases</a>
                      </li>
                      <li class="toc-h1 toc-link ">
                        <a href="notes-1.3.x.html">1.3.x Stable Releases</a>
                      </li>
                      <li class="toc-h1 toc-link ">
                        <a href="notes-1.2.x.html">1.2.x Stable Releases</a>
                      </li>
                      <li class="toc-h1 toc-link ">
                        <a href="notes-1.1.x.html">1.1.x Stable Releases</a>
                      </li>
                      <li class="toc-h1 toc-link ">
                        <a href="notes-1.0.x.html">1.0.x Stable Releases</a>
                      </li>
                      <li class="toc-h1 toc-link ">
                        <a href="notes-master.html">Master Pre-Releases</a>
                      </li>
                  </ul>
                </li>
                  <li class="toc-h1 toc-heading">
                    Developer
                  </li>
                  <li class="toc-h1 toc-link ">
                    <a href="dev.html">Pants Developer Center</a>
                  </li>
                  <li class="toc-h1 toc-link ">
                    <a href="export.html">Export Format</a>
                  </li>
          </ul>
        </div> <!-- site-toc -->
      </div>

      <div class="col-md-8">
        <div class="content">

          <div class="mainflow">

            <!-- main content start -->
            <!-- generated by pants! -->
<style>
.codehilite .hll { background-color: #ffffcc }
.codehilite  { background: #f0f0f0; }
.codehilite .c { color: #60a0b0; font-style: italic } /* Comment */
.codehilite .err { border: 1px solid #FF0000 } /* Error */
.codehilite .k { color: #007020; font-weight: bold } /* Keyword */
.codehilite .o { color: #666666 } /* Operator */
.codehilite .cm { color: #60a0b0; font-style: italic } /* Comment.Multiline */
.codehilite .cp { color: #007020 } /* Comment.Preproc */
.codehilite .c1 { color: #60a0b0; font-style: italic } /* Comment.Single */
.codehilite .cs { color: #60a0b0; background-color: #fff0f0 } /* Comment.Special */
.codehilite .gd { color: #A00000 } /* Generic.Deleted */
.codehilite .ge { font-style: italic } /* Generic.Emph */
.codehilite .gr { color: #FF0000 } /* Generic.Error */
.codehilite .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.codehilite .gi { color: #00A000 } /* Generic.Inserted */
.codehilite .go { color: #808080 } /* Generic.Output */
.codehilite .gp { color: #c65d09; font-weight: bold } /* Generic.Prompt */
.codehilite .gs { font-weight: bold } /* Generic.Strong */
.codehilite .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.codehilite .gt { color: #0040D0 } /* Generic.Traceback */
.codehilite .kc { color: #007020; font-weight: bold } /* Keyword.Constant */
.codehilite .kd { color: #007020; font-weight: bold } /* Keyword.Declaration */
.codehilite .kn { color: #007020; font-weight: bold } /* Keyword.Namespace */
.codehilite .kp { color: #007020 } /* Keyword.Pseudo */
.codehilite .kr { color: #007020; font-weight: bold } /* Keyword.Reserved */
.codehilite .kt { color: #902000 } /* Keyword.Type */
.codehilite .m { color: #40a070 } /* Literal.Number */
.codehilite .s { color: #4070a0 } /* Literal.String */
.codehilite .na { color: #4070a0 } /* Name.Attribute */
.codehilite .nb { color: #007020 } /* Name.Builtin */
.codehilite .nc { color: #0e84b5; font-weight: bold } /* Name.Class */
.codehilite .no { color: #60add5 } /* Name.Constant */
.codehilite .nd { color: #555555; font-weight: bold } /* Name.Decorator */
.codehilite .ni { color: #d55537; font-weight: bold } /* Name.Entity */
.codehilite .ne { color: #007020 } /* Name.Exception */
.codehilite .nf { color: #06287e } /* Name.Function */
.codehilite .nl { color: #002070; font-weight: bold } /* Name.Label */
.codehilite .nn { color: #0e84b5; font-weight: bold } /* Name.Namespace */
.codehilite .nt { color: #062873; font-weight: bold } /* Name.Tag */
.codehilite .nv { color: #bb60d5 } /* Name.Variable */
.codehilite .ow { color: #007020; font-weight: bold } /* Operator.Word */
.codehilite .w { color: #bbbbbb } /* Text.Whitespace */
.codehilite .mf { color: #40a070 } /* Literal.Number.Float */
.codehilite .mh { color: #40a070 } /* Literal.Number.Hex */
.codehilite .mi { color: #40a070 } /* Literal.Number.Integer */
.codehilite .mo { color: #40a070 } /* Literal.Number.Oct */
.codehilite .sb { color: #4070a0 } /* Literal.String.Backtick */
.codehilite .sc { color: #4070a0 } /* Literal.String.Char */
.codehilite .sd { color: #4070a0; font-style: italic } /* Literal.String.Doc */
.codehilite .s2 { color: #4070a0 } /* Literal.String.Double */
.codehilite .se { color: #4070a0; font-weight: bold } /* Literal.String.Escape */
.codehilite .sh { color: #4070a0 } /* Literal.String.Heredoc */
.codehilite .si { color: #70a0d0; font-style: italic } /* Literal.String.Interpol */
.codehilite .sx { color: #c65d09 } /* Literal.String.Other */
.codehilite .sr { color: #235388 } /* Literal.String.Regex */
.codehilite .s1 { color: #4070a0 } /* Literal.String.Single */
.codehilite .ss { color: #517918 } /* Literal.String.Symbol */
.codehilite .bp { color: #007020 } /* Name.Builtin.Pseudo */
.codehilite .vc { color: #bb60d5 } /* Name.Variable.Class */
.codehilite .vg { color: #bb60d5 } /* Name.Variable.Global */
.codehilite .vi { color: #bb60d5 } /* Name.Variable.Instance */
.codehilite .il { color: #40a070 } /* Literal.Number.Integer.Long */
</style>
<h1 id="develop-a-task-to-publish-extra-artifacts">Develop a Task to Publish "Extra" Artifacts</h1>
<p>Pants supports "publish plugins", which allow end-users to add
additional, arbitrary files to be published along with the primary
artifact. For example, let's say that along with publishing your jar
full of class files, you would also like to publish a companion file
that contains some metadata -- code coverage info, source git
repository, java version that created the jar, etc. To accomplish this,
you'll first need to write a custom task, which creates any additional
files (jar or otherwise) that you would like to publish. Next, you'll
create a <code>publish_extras</code> section under <code>[publish.jar]</code> in pants.ini,
and add a key for the new product type. Your custom task will create the
extra file(s) that you want to publish, and write the path to the
products map under the key that you have defined in pants.ini. The
publishing code will loop over all keys found in pants.ini, and consult
the product map. If pants finds a file for the current key, it will
gather it up, and bundle it in with the rest of the files being
published.</p>
<p>An example of a custom task is supplied in the
<code>examples/src/python/example/pants_publish_plugin</code> directory. To use it,
add the following to your pants.ini:</p>
<div class="codehilite"><pre>[publish.jar]
publish_extras: {
    'extra_test_jar_example': {
      'override_name': '{target_provides_name}-extra_example',
      'classifier': 'classy',
      'extension': 'jar',
    },
  }

[GLOBAL]
backend_packages: [
    'example.pants_publish_plugin',
  ]
</pre></div>
<p>In the above configuration example, the string
<code>'extra_test_jar_example'</code> is a key into the product map. In this case,
the example task will add additional files for publishing to the product
map under this key. And <code>jar_publish.py</code> will examine the product map,
looking for all keys defined here, and publishing any additional files
found.</p>
<h2 id="constructing-a-name-for-your-extra-artifact">Constructing a name for your extra artifact:</h2>
<p>By default, pants uses the following scheme when publishing artifacts:</p>
<div class="codehilite"><pre>[artifactId]-[version](-[classifier]).[ext]
</pre></div>
<p>The pants plugin publishing system allows a customization of the
artifact identifier, classifier, and file extension. To customize the
name of your extra object, you can supply some extra parameters in the
<code>pants.ini</code> file:</p>
<ul>
<li><code>override_name</code> -- allows customization of the name (<code>artifactId</code>)
    of the additional file published. Specifying a string will
    completely override the name, or include
    '<code>{target_provides_name}</code>' to tack an addition on to the
    pre-existing artifact name. Defaults to the pre-existing artifact
    name.</li>
<li><code>classifier</code> -- the maven classifier. Can be any arbitrary string,
    or leave this unspecified for nothing.</li>
<li><code>extension</code> -- the filename extension. Defaults to "jar".</li>
</ul>
<p><strong>Note:</strong> You must supply a non-default value for at least one of the
above parameters, otherwise your extra publish artifact won't have a
unique name. With the above config in your pants.ini, invoke pants like
this, to do a test publish:</p>
<div class="codehilite"><pre><span class="nv">WRAPPER_SRCPATH</span><span class="o">=</span>examples/src/python ./pants publish.jar --no-dryrun --local<span class="o">=</span>~/tmp <span class="se">\</span>
  examples/src/java/org/pantsbuild/example/hello/greet
</pre></div>
<p>Now if you examine the <code>/tmp</code> directory, you'll notice that an extra jar
has been published for the <code>greet</code> target:</p>
<div class="codehilite"><pre><span class="nv">$ </span>ls -1 /tmp/org/pantsbuild/example/hello-greet/0.0.1-SNAPSHOT/|grep example
hello-greet-extra_example-0.0.1-SNAPSHOT-classy.jar
hello-greet-extra_example-0.0.1-SNAPSHOT-classy.jar.md5
hello-greet-extra_example-0.0.1-SNAPSHOT-classy.jar.sha1
</pre></div>
<p>This example task should provide a rough starting guide, and can be
tailored to suit a more specific situation.</p>

            <!-- main content end -->

            <div class="generated">
              Generated by <a href="docs.html">publish_docs</a>
              from dist/markdown/html/src/docs/dev_tasks_publish_extras.html 2018-04-25T15:47:33.116906
            </div>

          </div> <!-- mainflow -->

        </div> <!-- content -->

      </div>

      <div class="col-md-1">
      </div>

    </div> <!-- row -->
  </div> <!-- container-fluid -->

</div> <!-- page -->

<script src="https://code.jquery.com/jquery-2.2.3.min.js" integrity="sha384-I6F5OKECLVtK/BL+8iSLDEHowSAfUo76ZL9+kGAgTRdiByINKJaqTPH/QVNS1VDb" crossorigin="anonymous"></script>
<script src="bootstrap-custom.min.js"></script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-78111411-1', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
